generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  userId      Int      @id @default(autoincrement())
  cmuAccount  String   @unique
  firstName   String
  lastName    String
  pswHash     String?
  phoneNum    String?
  roleName    String
  gender      String?
  createdAt   DateTime @default(now())
  isConsentAccepted Boolean  @default(false) 
  consentAcceptedAt DateTime?
  
  studentProfile   Student?
  counselorProfile Counselor?
  adminProfile     Admin?
}

model RegistrationCode {
  id        Int      @id @default(autoincrement())
  code      String   @unique
  isUsed    Boolean  @default(false)
  usedBy    String?
  usedAt    DateTime?
}

model Student {
  userId      Int     @id
  user        User    @relation(fields: [userId], references: [userId], onDelete: Cascade)
  studentId   String  @unique
  major       String?
  department  String?
  cases       Case[]
}

model Counselor {
  userId          Int     @id 
  user            User    @relation(fields: [userId], references: [userId], onDelete: Cascade)
  counselorNumber String?
  cases           Case[]
  sessions        Session[]
}

model Admin {
  userId      Int     @id 
  user        User    @relation(fields: [userId], references: [userId], onDelete: Cascade)
  adminNumber String?
}

model Case {
  caseId        Int      @id @default(autoincrement())
  topic         String?
  status        String   @default("waiting_confirmation")
  priority      String   @default("medium")
  refCode       String?
  createdAt     DateTime @default(now())
  studentId     String
  student       Student  @relation(fields: [studentId], references: [studentId])
  counselorId   Int?
  counselor     Counselor? @relation(fields: [counselorId], references: [userId])
  sessions      Session[]
}

model ProblemTag {
  id        Int      @id @default(autoincrement())
  label     String   @unique
  sessions  Session[]
}

model Session {
  sessionId     Int      @id @default(autoincrement())
  sessionName   String?
  timeStart     DateTime
  timeEnd       DateTime
  location      String?
  status        String   @default("available")
  createdAt     DateTime @default(now())
  caseId        Int?
  case          Case?    @relation(fields: [caseId], references: [caseId])
  counselorId   Int?
  counselor     Counselor? @relation(fields: [counselorId], references: [userId])
  counselorNote String?    @db.Text
  moodScale     Int?
  problemTags   ProblemTag[]
}